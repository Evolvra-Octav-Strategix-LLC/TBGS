root@212:~# docker compose build --no-cache tbgs-app
no configuration file provided: not found
root@212:~# docker compose up -d
no configuration file provided: not found
root@212:~# cd /opt/tbgs
root@212:/opt/tbgs# # 1. First, fix the .env database URL (this was the original problem)
cat > .env << 'EOF'
# TBGS Production Environment
NODE_ENV=production

# Database Configuration (Local PostgreSQL Container)
POSTGRES_USER=tbgs_user
POSTGRES_PASSWORD=TBGSSecure2024!Production
POSTGRES_DB=tbgs_production
DATABASE_URL=postgresql://tbgs_user:TBGSSecure2024!Production@postgres:5432/tbgs_production

# Email Configuration
GMAIL_USER=Info@tbgs.nl
GMAIL_APP_PASSWORD=afsd vblw wipc hqnp

# Google Places API
GOOGLE_PLACES_API_KEY=AIzaSyDcnWjazRb8XCuRFrCASBxwEjhCg4s2IMw

# Session Security
SESSION_SECRET=L3xG6brvJTE3J/pujVXWk5nMp1DXepNwKGKsp/YNt3+AtOcZnYlVNKQ3d1xUpK/U4tChG/DOrImqTvN9bLZd3A==

# pgAdmin Configuration
PGADMIN_EMAIL=admin@tbgs.nl
PGADMIN_PASSWORD=TBGSAdmin2024!

# Nextcloud Configuration
NEXTCLOUD_DB_USER=nextcloud_user
NEXTCLOUD_DB_PASSWORD=NextcloudSecure2024!
NEXTCLOUD_ADMIN_USER=admin
NEXTCLOUD_ADMIN_PASSWORD=TBGSNextcloud2024!
NEXTCLOUD_TRUSTED_DOMAINS=nextcloud.tbgs.nl,tbgs.nl,212.192.2.129
NEXTCLOUD_HOST=nextcloud.tbgs.nl
EOF

# 2. Rebuild the image with the dependency fix
docker compose build --no-cache tbgs-app

# 3. Start fresh containers
docker compose up -d

# 4. Watch the logs to confirm it works
docker logs tbgs-app --follow
[+] Building 137.8s (20/20) FINISHED                                                    
 => [internal] load local bake definitions                                         0.0s
 => => reading from stdin 497B                                                     0.0s
 => [internal] load build definition from Dockerfile                               0.0s
 => => transferring dockerfile: 1.61kB                                             0.0s
 => [internal] load metadata for docker.io/library/node:20-alpine                  0.8s
 => [internal] load .dockerignore                                                  0.0s
 => => transferring context: 545B                                                  0.0s
 => CACHED [builder 1/6] FROM docker.io/library/node:20-alpine@sha256:eabac870db9  0.0s
 => [internal] load build context                                                  0.2s
 => => transferring context: 8.50MB                                                0.2s
 => [production 2/8] RUN apk add --no-cache tini &&     addgroup -g 1001 -S tbgs   1.6s
 => CACHED [builder 2/6] WORKDIR /app                                              0.0s
 => [builder 3/6] COPY package*.json ./                                            0.1s
 => [builder 4/6] RUN npm ci && npm cache clean --force                           28.2s
 => [production 3/8] WORKDIR /app                                                  0.1s 
 => [production 4/8] COPY package*.json ./                                         0.1s 
 => [production 5/8] RUN npm ci --only=production && npm cache clean --force      25.9s 
 => [builder 5/6] COPY . .                                                         0.6s 
 => [builder 6/6] RUN npm run build &&     mkdir -p dist/server &&     npx esbui  14.2s 
 => [production 6/8] COPY --from=builder /app/dist ./dist                          0.1s 
 => [production 7/8] COPY --from=builder /app/shared ./shared                      0.0s 
 => [production 8/8] RUN mkdir -p uploads && chown -R tbgs:tbgs /app              86.6s 
 => exporting to image                                                             5.6s 
 => => exporting layers                                                            5.6s 
 => => writing image sha256:6689c4df7f8dc040e47a0df7979ce72e18fbabe3ca95a508a6aaf  0.0s 
 => => naming to docker.io/library/tbgs-tbgs-app                                   0.0s 
 => resolving provenance for metadata file                                         0.0s 
[+] Building 1/1                                                                        
 ✔ tbgs-tbgs-app  Built                                                            0.0s 
[+] Running 7/7
 ✔ Container tbgs-dashy                Running                                     0.0s 
 ✔ Container tbgs-postgres             Healthy                                     0.6s 
 ✔ Container tbgs-portainer            Running                                     0.0s 
 ✔ Container tbgs-pgadmin              Running                                     0.0s 
 ✔ Container tbgs-nextcloud            Running                                     0.0s 
 ✔ Container tbgs-app                  Started                                     0.9s 
 ✔ Container tbgs-nginx-proxy-manager  Run...                                      0.0s 
node:internal/modules/esm/resolve:873
  throw new ERR_MODULE_NOT_FOUND(packageName, fileURLToPath(base), null);
        ^

Error [ERR_MODULE_NOT_FOUND]: Cannot find package 'vite' imported from /app/dist/server/index.js
    at packageResolve (node:internal/modules/esm/resolve:873:9)
    at moduleResolve (node:internal/modules/esm/resolve:946:18)
    at defaultResolve (node:internal/modules/esm/resolve:1188:11)
    at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:708:12)
    at #cachedDefaultResolve (node:internal/modules/esm/loader:657:25)
    at ModuleLoader.resolve (node:internal/modules/esm/loader:640:38)
    at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:264:38)
    at ModuleJob._link (node:internal/modules/esm/module_job:168:49) {
  code: 'ERR_MODULE_NOT_FOUND'
}

Node.js v20.19.5
root@212:/opt/tbgs# 